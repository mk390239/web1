<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>固定位置WebAR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs vr-mode-ui="enabled: false">
        
        <!-- 标记 -->
        <a-marker preset="hiro" id="marker" emitevents="true">
            <a-entity 
                id="floating-model"
                gltf-model="4.glb"
                scale="0.3 0.3 0.3"
                visible="true"
            ></a-entity>
        </a-marker>
        
        <!-- 固定在标记位置的模型（初始隐藏） -->
        <a-entity
            id="fixed-model"
            gltf-model="4.glb"
            scale="0.3 0.3 0.3"
            visible="false"
        ></a-entity>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let isModelFixed = false;
        const marker = document.querySelector('#marker');
        const floatingModel = document.querySelector('#floating-model');
        const fixedModel = document.querySelector('#fixed-model');
        
        // 当标记被识别时
        marker.addEventListener('markerFound', function() {
            console.log('标记识别成功');
            
            if (!isModelFixed) {
                // 第一次识别时，记录标记位置并固定模型
                const markerPosition = marker.getAttribute('position');
                const markerRotation = marker.getAttribute('rotation');
                
                // 设置固定模型的位置和旋转
                fixedModel.setAttribute('position', markerPosition);
                fixedModel.setAttribute('rotation', markerRotation);
                fixedModel.setAttribute('visible', 'true');
                
                // 隐藏浮动模型
                floatingModel.setAttribute('visible', 'false');
                
                isModelFixed = true;
                console.log('模型已固定在标记位置');
            }
        });
        
        // 当标记丢失时（视角挪开）
        marker.addEventListener('markerLost', function() {
            console.log('标记丢失，但固定模型保持在原位置');
            // 固定模型继续保持显示，浮动模型隐藏
            floatingModel.setAttribute('visible', 'false');
        });
        
        // 双击屏幕重置（可以重新定位）
        document.querySelector('a-scene').addEventListener('dblclick', function() {
            fixedModel.setAttribute('visible', 'false');
            floatingModel.setAttribute('visible', 'true');
            isModelFixed = false;
            console.log('已重置，重新扫描标记可再次固定模型');
        });
    </script>
</body>
</html>
